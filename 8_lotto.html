<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto</title>
    <style>
        .ball{
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #f0f0f0;
            text-align: center;
            line-height: 30px;
            margin: 5px;
            font-size: 16px;
            color: #333;
        }
    </style>
</head>

<body>
    <form id="form">
        <input name="inputtag" id="input" placeholder="ë¡œë˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1,2,3,4,5,6)" />
        <button>ì œì¶œ</button>
    </form>
    <div id="result">ë‹¹ì²¨ ìˆ«ì: </div>
    <div id="bonus">ë³´ë„ˆìŠ¤ ìˆ«ì: </div>

    <script>
        const $form = document.querySelector('#form');
        const $input = document.querySelector('#input');
        const $result = document.querySelector('#result');
        const $bonus = document.querySelector('#bonus');
        const $button = document.querySelector('button');

        
        const delay = (ms) => new Promise((resolve,reject) => {
             if (ms > 10000) {
                reject(new Error('â° delay ì‹œê°„ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤! (10ì´ˆ ì´í•˜ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”)'));
            } else {
                setTimeout(resolve, ms);
            }
        });
        
        const drawBalls = (number, $target) => {
        const $ball = document.createElement('div');
        $ball.className = 'ball';
        $ball.textContent = number;
        if(number < 10) {
            $ball.style.backgroundColor = '#ffcccc'; // 1~9ë²ˆì€ ì—°í•œ ë¹¨ê°•
        } else if(number < 20) {
            $ball.style.backgroundColor = '#ccffcc'; // 10~19ë²ˆì€ ì—°í•œ ì´ˆë¡
        } else if(number < 30) {
            $ball.style.backgroundColor = '#ccccff'; // 20~29ë²ˆì€ ì—°í•œ íŒŒë‘
        } else if(number < 40) {
            $ball.style.backgroundColor = '#ffffcc'; // 30~39ë²ˆì€ ì—°í•œ ë…¸ë‘
        } else {
            $ball.style.backgroundColor = '#ffccff'; // 40~45ë²ˆì€ ì—°í•œ ë³´ë¼
        }
        $target.appendChild($ball);
        };

        $form.addEventListener('submit', async(e) =>{
            e.preventDefault();
              $button.disabled = true; // âœ… ë²„íŠ¼ ì ê¸ˆ

            $result.innerHTML = 'ë‹¹ì²¨ ìˆ«ì: ';
            $bonus.innerHTML = 'ë³´ë„ˆìŠ¤ ìˆ«ì: ';

            // $result.textContent = 'ë‹¹ì²¨ ìˆ«ì: ';
            // $bonus.textContent = 'ë³´ë„ˆìŠ¤ ìˆ«ì: ';


            const input = $input.value;
            // const input = e.target.inputtag.value; name ì†ì„±ìœ¼ë¡œë„ ì ‘ê·¼ ê°€ëŠ¥
            if(!input) {
                alert('ë¡œë˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            if(input.split(',').length !== 6) {
                alert('ë¡œë˜ ë²ˆí˜¸ëŠ” 6ê°œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }
            if(new Set(input.split(',').map(v => parseInt(v.trim()))).size !== 6) {
                alert('ë¡œë˜ ë²ˆí˜¸ëŠ” ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }
            const numbers = input.split(',').map(v => parseInt(v.trim()));
            if(numbers.some(v => v < 1 || v > 45)) { // findë„ ê°€ëŠ¥
                alert('ë¡œë˜ ë²ˆí˜¸ëŠ” 1ë¶€í„° 45 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }
            if (numbers.some(v => Number.isNaN(v))) {
                alert('ëª¨ë“  ì…ë ¥ì€ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }

            const lottoNumbers = Array.from({length: 45}, (_, i) => i + 1);
        //  const shuffled = lottoNumbers.sort(() => Math.random() - 0.5); // ê°„ë‹¨í•œ ì…”í”Œ
            const shuffled = [];
            while(lottoNumbers.length > 0) {
                const idx = Math.floor(Math.random() * lottoNumbers.length);
                const spliced = lottoNumbers.splice(idx, 1)[0]; // spliceë¡œ ì œê±°í•˜ë©´ì„œ ë°˜í™˜
                shuffled.push(spliced);
            }

            const winballs = shuffled.slice(0, 6).sort((a, b) => a - b);
            const bonus = shuffled[6];

            try { // ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ê¸°ì²˜ëŸ¼ ì‚¬ìš©í•˜ê¸° 
                for(let i = 0; i < winballs.length; i++) {
                    await delay(1000);  // ë¬¸ì œê°€ ì—†ë‹¤ë©´ ì—¬ê¸´ ì •ìƒ ì‘ë™
                    drawBalls(winballs[i], $result);
                }

                await delay(1000);
                drawBalls(bonus, $bonus);

                await delay(0); // alert ë©”ì„œë“œëŠ” í™”ë©´ì„ ê·¸ë¦¬ëŠ” ë™ì‘ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë¼ì„œ í™”ë©´ì´ ê·¸ë ¤ì§€ê¸°ê¹Œì§€ ëŒ€ê¸° 
            } catch (err) {
                alert('ğŸš¨ ì—ëŸ¬ ë°œìƒ: ' + err.message);
                $button.disabled = false;
                return;
            }




            // const drawBalls = (numbers, $target) => {  // ë¹„ë™ê¸° í•¨ìˆ˜ ë°©ì‹ 
            //     const $ball = document.createElement('div');
            //     $ball.className = 'ball';
            //     $ball.textContent = numbers;
            //     $target.appendChild($ball);
            // };

            // for(let i = 0; i<winballs.length; i++){
            //     setTimeout(() => {
            //         drawBalls(winballs[i], $result);
            //     }, i * 1000);
            // }

            // // for(let i = 0; i<winballs.length; i++){
            // //     setTimeout( drawBalls(winballs[i], $result), i * 1000);
            // // } ì´ë ‡ê²Œ ë°”ê¾¸ë ¤ë©´ drawBalls í•¨ìˆ˜ë¥¼  í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í˜•íƒœë¡œ ë°”ê¿”ì•¼í•¨

            // setTimeout(() => {
            //     drawBalls(bonus, $bonus);
            // }, 7000);

            let count = 0;
            numbers.forEach((v) => {
                if(winballs.includes(v)) {
                    count++;
                }
            });

            if(count === 6) {
                alert('1ë“±ì…ë‹ˆë‹¤!');
            } else if(count === 5) {
                if(winballs.includes(bonus)) {
                    alert('2ë“±ì…ë‹ˆë‹¤!');
                } else {
                    alert('3ë“±ì…ë‹ˆë‹¤!');
                }
            } else if(count === 4) {
                alert('4ë“±ì…ë‹ˆë‹¤!');
            } else if(count === 3) {
                alert('5ë“±ì…ë‹ˆë‹¤!');
            } else {
                alert('ê½ì…ë‹ˆë‹¤!');
            }

            $button.disabled = false; // âœ… ë²„íŠ¼ ì ê¸ˆ í•´ì œ
            // $input.value = ''; // ì…ë ¥ì°½ ì´ˆê¸°í™”
            // $input.focus(); // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤

        });


    </script>
</body>
</html>